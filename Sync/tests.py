import unittest
import configparser

from utils import add_extra_data


config = configparser.ConfigParser()
config.read('config.ini')


class TestSyncLast30(unittest.TestCase):

    def setUp(self):
        self.CLOSED_ORDERS_FROM_SQLITE = [[169, 'emu', 0.0069700000000000005, 1679775962, 1679775943, 1679775943, 14203.7, 0.00692, 99.07403884175002, 98.215886797, -0.8581520447500282, 0, 0, 'MoonShot: (strategy <MS_1.02r_TRG10>)', 1, 'MoonShot: (strategy <MS_1.02r_TRG10>)\r\nEMA(14min, 3min) = 0.11%  EMA(5min, 90sec) = -2.36%  EMA(118sec, 62sec) = -0.58%  EMA(80sec, 36sec) = -0.43%  EMA(30sec, 15sec) = 0.10%  \r\n CPU: Bot 1 Sys: 1  AppLatency: 0.0 sec  API Req: 133 / 1200   API Orders: 9 / 50   Orders 1D: 1232 / 160000  PriceLag: 0.00% (LUNA PriceLag: 0.02%)\r\nLatency: 13 / 13  Ping: 10 / 10', 8, 14203.7, 0.1871236348921077, 0.07362537676728641, 'Pump_BUSD-COS_03-25-23-26-02_2.bin', 0, 1, 0, -0.6889501818769206, -1.4106096985011023, 0.5009906874195573, 0.1368284724015118, 0, 'Emulator', 'StopLoss AutoActivated on price drop: BID = 0.006920 BidEMA: 0.006920 LastPrice = 0.006930 BuyPrice = 0.006970 (strategy <MS_1.02r_TRG10>); StopLoss fixed: 0.006935 AllowedDrop: BU', 5.006858710562434, 4.458161865569266, 22.13622291021671, 20.09132420091322, 11.91489361702127, 4.953338119167275, 5.209840810419683, 2.170767004341533, 0.05090095793334006, 0.0024431415367871523, 36.2317008972168, 1, 1328731.479176, 1566402.111640999, 4870, 1470188.292541504, 'COS'], [170, 'emu', 0.03098, 1679776294, 1679776294, 1679776294, 3195.6, 0.0312, 99.073937766, 99.62794296, 0.5540051939999984, 0, 0, 'MoonShot: (strategy <MS_1.02r_TRG10>)', 1, 'MoonShot: (strategy <MS_1.02r_TRG10>)\r\nEMA(14min, 3min) = 1.04%  EMA(5min, 90sec) = -0.30%  EMA(118sec, 62sec) = -0.14%  EMA(80sec, 36sec) = -0.25%  EMA(30sec, 15sec) = -0.21%  \r\n CPU: Bot 1 Sys: 2  AppLatency: 0.0 sec  API Req: 100 / 1200   API Orders: 3 / 50   Orders 1D: 1309 / 160000  PriceLag: 0.00% (LUNA PriceLag: 0.02%)\r\nLatency: 16 / 16  Ping: 10 / 10', 8, 3195.6, 0.24012014095536813, 0.16558706628954034, 'Pump_BUSD-REI_03-25-23-31-34_2.bin', 0, 1, 0, -0.6086862209489886, -1.3291023397614068, 0.5994525233503375, 0.16491464877486572, 0, 'Emulator', 'Sell Price', 2.4669461464043696, 0.0, 3.3711507293354925, 2.4531956100710017, 2.4174053182916913, 1.4365522745410984, 3.583061889250815, 3.094462540716599, 0.06629917493546482, 0.0, 24.501312255859375, 1, 7689.732843, 90324.68378400001, 5183, 73409.80408477783, 'REI'], [171, 'emu', 0.060300000000000006, 1679776357, 1679776355, 1679776355, 1641.7, 0.06042000000000001, 99.06875588250001, 99.11712036450001, 0.048364481999996656, 0, 0, 'MoonShot: (strategy <MS_1.02r_TRG10>)', 1, 'MoonShot: (strategy <MS_1.02r_TRG10>)\r\nEMA(14min, 3min) = 0.14%  EMA(5min, 90sec) = -1.26%  EMA(118sec, 62sec) = -0.31%  EMA(80sec, 36sec) = -0.30%  EMA(30sec, 15sec) = -0.14%  \r\n CPU: Bot 2 Sys: 2  AppLatency: 0.0 sec  API Req: 111 / 1200   API Orders: 3 / 50   Orders 1D: 1317 / 160000  PriceLag: 0.00% (LUNA PriceLag: 0.02%)\r\nLatency: 14 / 14  Ping: 10 / 10', 8, 1641.7, 0.14820268538780212, 0.13385234260417506, 'Pump_BUSD-MDT_03-25-23-32-37_3.bin', 0, 1, 0, -0.6956418759461147, -1.3474414856248216, 1.2441889782886548, 0.154071552264479, 0, 'Emulator', 'Auto Price Down', 0.0, 2.197625922361235, 14.814213856887882, 4.997566120395924, 2.2056411938340426, 2.2056411938340426, 3.4976682211858714, 2.231845436375751, 0.0773148840660732, 0.0, 3.471437454223633, 1, 105527.02991099999, 5615523.8635009965, 5273, 205792.0790939331, 'MDT'], [172, 'emu', 0.059480000000000005, 1679776518, 1679776509, 1679776509, 1664.4, 0.05960000000000001, 99.07276088400002, 99.12384132000001, 0.051080435999992346, 0, 0, 'MoonShot: (strategy <MS_1.02r_TRG10>)', 1, 'MoonShot: (strategy <MS_1.02r_TRG10>)\r\nEMA(14min, 3min) = -1.44%  EMA(5min, 90sec) = -1.99%  EMA(118sec, 62sec) = -0.45%  EMA(80sec, 36sec) = -0.37%  EMA(30sec, 15sec) = -0.15%  \r\n CPU: Bot 0 Sys: 1  AppLatency: 0.0 sec  API Req: 27 / 1200   API Orders: 1 / 50   Orders 1D: 1333 / 160000  PriceLag: 0.00% (LUNA PriceLag: 0.02%)\r\nLatency: 35 / 35  Ping: 10 / 10', 8, 1664.4, 0.21700271806138866, 0.16461593643368871, 'Pump_BUSD-MDT_03-25-23-35-18_4.bin', 0, 1, 0, -0.6172690459507996, -1.3225706680174691, 0.05368511841935228, 0.15806973270431454, 0, 'Emulator', 'Auto Price Down', 0.0, 3.7536092396534992, 14.814213856887882, 4.997566120395924, 3.814441575747481, 3.814441575747481, 3.5822401614530777, 1.7154389505549952, 0.05827501566551855, 0.0, 3.4912121295928955, 1, 105527.02991099999, 5615523.8635009965, 5371, 242637.9185256958, 'MDT'], [173, 'emu', 0.023556590000000002, 1679777041, 1679777040, 1679777040, 4202.0, 0.023665330000000002, 99.059029773385, 99.367135372505, 0.30810559911999746, 0, 0, 'MoonShot: (strategy <MS_1.02r_TRG10>)', 1, 'MoonShot: (strategy <MS_1.02r_TRG10>)\r\nEMA(14min, 3min) = 2.19%  EMA(5min, 90sec) = -1.72%  EMA(118sec, 62sec) = -0.11%  EMA(80sec, 36sec) = -0.09%  EMA(30sec, 15sec) = -0.15%  \r\n CPU: Bot 1 Sys: 3  AppLatency: 0.0 sec  API Req: 168 / 1200   API Orders: 3 / 50   Orders 1D: 1351 / 160000  PriceLag: 0.03% (EOS PriceLag: 0.05%)\r\nLatency: 16 / 16  Ping: 10 / 10', 8, 4202.0, 0.4386757628153109, 0.31015035879042796, 'Pump_BUSD-USTC_03-25-23-44-01_2.bin', 0, 1, 0, -0.335854216018605, -1.1531104757167463, 1.3157216367253863, 0.3089657605323831, 0, 'Emulator', 'Sell Price', 21.896066709459472, 0.1320513237670795, 22.270193205670225, 22.270193205670225, 22.057244917126148, 7.387458209776857, 4.441625231050464, 2.697626343611139, 0.08068001728857142, 0.002286195056512952, 13.928446769714355, 1, 102804.82135, 2261137.0986944595, 5456, 5109453.704030991, 'USTC']]
        self.BOT_NAME = config['bot']['name']
        self.CUR = config['bot']['currency']

    def test_add_extra_data_with_currency(self):
        rows = add_extra_data(self.CLOSED_ORDERS_FROM_SQLITE, self.BOT_NAME, self.CUR)
        self.assertEqual(len(rows), len(self.CLOSED_ORDERS_FROM_SQLITE))
        self.assertIn(self.BOT_NAME, rows[0])
        self.assertIn(self.CUR, rows[0])
    
    def test_add_extra_data_without_currency(self):
        rows = add_extra_data(self.CLOSED_ORDERS_FROM_SQLITE, self.BOT_NAME)
        self.assertEqual(len(rows), len(self.CLOSED_ORDERS_FROM_SQLITE))
        self.assertIn(self.BOT_NAME, rows[0])
        self.assertNotIn(self.CUR, rows[0])


if __name__ == '__main__':
    unittest.main()
